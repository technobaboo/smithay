<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Utilities for handling surfaces, subsurfaces and regions"><title>smithay::wayland::compositor - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-f3501f0f5ae15dfb.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smithay" data-themes="" data-resource-suffix="" data-rustdoc-version="1.71.0-nightly (1a5f8bce7 2023-05-26)" data-search-js="search-4926e5fc22a5646a.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../../../static.files/main-f0540c1d82cde29b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../smithay/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../smithay/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module compositor</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">smithay</a>::<wbr><a href="../index.html">wayland</a>::<wbr><a class="mod" href="#">compositor</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/smithay/wayland/compositor/mod.rs.html#1-684">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Utilities for handling surfaces, subsurfaces and regions</p>
<p>This module provides automatic handling of surfaces, subsurfaces
and region Wayland objects, by registering an implementation for
for the <a href="wayland_server::protocol::wl_compositor"><code>wl_compositor</code></a>
and <a href="wayland_server::protocol::wl_subcompositor"><code>wl_subcompositor</code></a> globals.</p>
<h3 id="why-use-this-implementation"><a href="#why-use-this-implementation">Why use this implementation</a></h3>
<p>This implementation does a simple job: it stores in a coherent way the state of
surface trees with subsurfaces, to provide you direct access to the tree
structure and all surface attributes, and handles the application of double-buffered
state.</p>
<p>As such, you can, given a root surface with a role requiring it to be displayed,
you can iterate over the whole tree of subsurfaces to recover all the metadata you
need to display the subsurface tree.</p>
<p>This implementation will not do anything more than present you the metadata specified by the
client in a coherent and practical way. All the logic regarding drawing itself, and
the positioning of windows (surface trees) one relative to another is out of its scope.</p>
<h3 id="how-to-use-it"><a href="#how-to-use-it">How to use it</a></h3><h4 id="initialization"><a href="#initialization">Initialization</a></h4>
<p>To initialize this implementation create the <a href="struct.CompositorState.html" title="struct smithay::wayland::compositor::CompositorState"><code>CompositorState</code></a>, store it inside your <code>State</code> struct
and implement the <a href="trait.CompositorHandler.html" title="trait smithay::wayland::compositor::CompositorHandler"><code>CompositorHandler</code></a>, as shown in this example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>smithay::delegate_compositor;
<span class="kw">use </span>smithay::wayland::compositor::{CompositorState, CompositorClientState, CompositorHandler};

<span class="comment">// Create the compositor state
</span><span class="kw">let </span>compositor_state = CompositorState::new::&lt;State&gt;(
    <span class="kw-2">&amp;</span>display.handle(),
);

<span class="comment">// insert the CompositorState into your state
// ..

// implement the necessary traits
</span><span class="kw">impl </span>CompositorHandler <span class="kw">for </span>State {
   <span class="kw">fn </span>compositor_state(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;mut </span>CompositorState {
       <span class="kw-2">&amp;mut </span><span class="self">self</span>.compositor_state
   }

   <span class="kw">fn </span>client_compositor_state&lt;<span class="lifetime">&#39;a</span>&gt;(<span class="kw-2">&amp;</span><span class="self">self</span>, client: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>wayland_server::Client) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>CompositorClientState {
       <span class="kw-2">&amp;</span>client.get_data::&lt;ClientState&gt;().unwrap().compositor_state    
   }

   <span class="kw">fn </span>commit(<span class="kw-2">&amp;mut </span><span class="self">self</span>, surface: <span class="kw-2">&amp;</span>wayland_server::protocol::wl_surface::WlSurface) {
       <span class="comment">// called on every buffer commit.
       // .. your implementation ..
   </span>}
}
<span class="macro">delegate_compositor!</span>(State);

<span class="comment">// You&#39;re now ready to go!</span></code></pre></div>
<h4 id="use-the-surface-states"><a href="#use-the-surface-states">Use the surface states</a></h4>
<p>The main access to surface states is done through the <a href="fn.with_states.html" title="fn smithay::wayland::compositor::with_states"><code>with_states</code></a> function, which
gives you access to the <a href="struct.SurfaceData.html" title="struct smithay::wayland::compositor::SurfaceData"><code>SurfaceData</code></a> instance associated with this surface. It acts
as a general purpose container for associating state to a surface, double-buffered or
not. See its documentation for more details.</p>
<h4 id="state-application-and-hooks"><a href="#state-application-and-hooks">State application and hooks</a></h4>
<p>On commit of a surface several steps are taken to update the state of the surface. Actions
are taken by smithay in the following order:</p>
<ol>
<li>Pre Commit hooks registered to this surface are invoked. Such hooks can be registered using
the <a href="fn.add_pre_commit_hook.html" title="fn smithay::wayland::compositor::add_pre_commit_hook"><code>add_pre_commit_hook</code></a> function. They are typically used by protocol extensions that
add state to a surface and need to check on commit that client did not request an
illegal state before it is applied on commit.</li>
<li>The pending state is either applied and made current, or cached for later application
is the surface is a synchronize subsurface. If the current state is applied, state
of the synchronized children subsurface are applied as well at this point.</li>
<li>Post Commit hooks registered to this surface are invoked. Such hooks can be registered using
the <a href="fn.add_post_commit_hook.html" title="fn smithay::wayland::compositor::add_post_commit_hook"><code>add_post_commit_hook</code></a> function. They are typically used by abstractions that further process
the state.</li>
<li>Your implementation of <a href="trait.CompositorHandler.html#tymethod.commit" title="method smithay::wayland::compositor::CompositorHandler::commit"><code>CompositorHandler::commit</code></a> is invoked, so that you can access
the new current state of the surface. The state of sync children subsurfaces of your
surface may have changed as well, so this is the place to check it, using functions
like <a href="fn.with_surface_tree_upward.html" title="fn smithay::wayland::compositor::with_surface_tree_upward"><code>with_surface_tree_upward</code></a> or <a href="fn.with_surface_tree_downward.html" title="fn smithay::wayland::compositor::with_surface_tree_downward"><code>with_surface_tree_downward</code></a>. On the other hand,
if the surface is a sync subsurface, its current state will note have changed as
the result of that commit. You can check if it is using <a href="fn.is_sync_subsurface.html" title="fn smithay::wayland::compositor::is_sync_subsurface"><code>is_sync_subsurface</code></a>.</li>
<li>If the surface is destroyed, destruction hooks are invoked. Such hooks can be registered
using the <a href="fn.add_destruction_hook.html" title="fn smithay::wayland::compositor::add_destruction_hook"><code>add_destruction_hook</code></a> function. They are typically used to cleanup associated
state.</li>
</ol>
<h4 id="surface-roles"><a href="#surface-roles">Surface roles</a></h4>
<p>The wayland protocol specifies that a surface needs to be assigned a role before it can
be displayed. Furthermore, a surface can only have a single role during its whole lifetime.
Smithay represents this role as a <code>&amp;'static str</code> identifier, that can only be set once
on a surface. See <a href="fn.give_role.html" title="fn smithay::wayland::compositor::give_role"><code>give_role</code></a> and <a href="fn.get_role.html" title="fn smithay::wayland::compositor::get_role"><code>get_role</code></a> for details. This module manages the
subsurface role, which is identified by the string <code>&quot;subsurface&quot;</code>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.AlreadyHasRole.html" title="struct smithay::wayland::compositor::AlreadyHasRole">AlreadyHasRole</a></div><div class="desc docblock-short">An error type signifying that the surface already has a role and
cannot be assigned an other</div></li><li><div class="item-name"><a class="struct" href="struct.CompositorClientState.html" title="struct smithay::wayland::compositor::CompositorClientState">CompositorClientState</a></div><div class="desc docblock-short">Per-client state of a compositor</div></li><li><div class="item-name"><a class="struct" href="struct.CompositorState.html" title="struct smithay::wayland::compositor::CompositorState">CompositorState</a></div><div class="desc docblock-short">State of a compositor</div></li><li><div class="item-name"><a class="struct" href="struct.MultiCache.html" title="struct smithay::wayland::compositor::MultiCache">MultiCache</a></div><div class="desc docblock-short">A typemap-like container for double-buffered values</div></li><li><div class="item-name"><a class="struct" href="struct.RegionAttributes.html" title="struct smithay::wayland::compositor::RegionAttributes">RegionAttributes</a></div><div class="desc docblock-short">Description of the contents of a region</div></li><li><div class="item-name"><a class="struct" href="struct.RegionUserData.html" title="struct smithay::wayland::compositor::RegionUserData">RegionUserData</a></div><div class="desc docblock-short">User data of WlRegion</div></li><li><div class="item-name"><a class="struct" href="struct.SubsurfaceCachedState.html" title="struct smithay::wayland::compositor::SubsurfaceCachedState">SubsurfaceCachedState</a></div><div class="desc docblock-short">The cached state associated with a subsurface</div></li><li><div class="item-name"><a class="struct" href="struct.SubsurfaceUserData.html" title="struct smithay::wayland::compositor::SubsurfaceUserData">SubsurfaceUserData</a></div><div class="desc docblock-short">User data of WlSubsurface</div></li><li><div class="item-name"><a class="struct" href="struct.SurfaceAttributes.html" title="struct smithay::wayland::compositor::SurfaceAttributes">SurfaceAttributes</a></div><div class="desc docblock-short">General state associated with a surface</div></li><li><div class="item-name"><a class="struct" href="struct.SurfaceData.html" title="struct smithay::wayland::compositor::SurfaceData">SurfaceData</a></div><div class="desc docblock-short">The state container associated with a surface</div></li><li><div class="item-name"><a class="struct" href="struct.SurfaceUserData.html" title="struct smithay::wayland::compositor::SurfaceUserData">SurfaceUserData</a></div><div class="desc docblock-short">User data for WlSurface</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.BlockerState.html" title="enum smithay::wayland::compositor::BlockerState">BlockerState</a></div><div class="desc docblock-short">States of a <a href="trait.Blocker.html" title="trait smithay::wayland::compositor::Blocker"><code>Blocker</code></a></div></li><li><div class="item-name"><a class="enum" href="enum.BufferAssignment.html" title="enum smithay::wayland::compositor::BufferAssignment">BufferAssignment</a></div><div class="desc docblock-short">New buffer assignation for a surface</div></li><li><div class="item-name"><a class="enum" href="enum.Damage.html" title="enum smithay::wayland::compositor::Damage">Damage</a></div><div class="desc docblock-short">Description of a part of a surface that
should be considered damaged and needs to be redrawn</div></li><li><div class="item-name"><a class="enum" href="enum.RectangleKind.html" title="enum smithay::wayland::compositor::RectangleKind">RectangleKind</a></div><div class="desc docblock-short">Kind of a rectangle part of a region</div></li><li><div class="item-name"><a class="enum" href="enum.TraversalAction.html" title="enum smithay::wayland::compositor::TraversalAction">TraversalAction</a></div><div class="desc docblock-short">Possible actions to do after handling a node during tree traversal</div></li></ul><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.SUBSURFACE_ROLE.html" title="constant smithay::wayland::compositor::SUBSURFACE_ROLE">SUBSURFACE_ROLE</a></div><div class="desc docblock-short">The role of a subsurface surface.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Blocker.html" title="trait smithay::wayland::compositor::Blocker">Blocker</a></div><div class="desc docblock-short">Types potentially blocking state changes</div></li><li><div class="item-name"><a class="trait" href="trait.Cacheable.html" title="trait smithay::wayland::compositor::Cacheable">Cacheable</a></div><div class="desc docblock-short">Trait representing a value that can be used in double-buffered storage</div></li><li><div class="item-name"><a class="trait" href="trait.CompositorHandler.html" title="trait smithay::wayland::compositor::CompositorHandler">CompositorHandler</a></div><div class="desc docblock-short">Handler trait for compositor</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.add_blocker.html" title="fn smithay::wayland::compositor::add_blocker">add_blocker</a></div><div class="desc docblock-short">Adds a blocker for the currently queued up state changes of the given surface.</div></li><li><div class="item-name"><a class="fn" href="fn.add_destruction_hook.html" title="fn smithay::wayland::compositor::add_destruction_hook">add_destruction_hook</a></div><div class="desc docblock-short">Register a destruction hook to be invoked on surface destruction</div></li><li><div class="item-name"><a class="fn" href="fn.add_post_commit_hook.html" title="fn smithay::wayland::compositor::add_post_commit_hook">add_post_commit_hook</a></div><div class="desc docblock-short">Register a post-commit hook to be invoked on surface commit</div></li><li><div class="item-name"><a class="fn" href="fn.add_pre_commit_hook.html" title="fn smithay::wayland::compositor::add_pre_commit_hook">add_pre_commit_hook</a></div><div class="desc docblock-short">Register a pre-commit hook to be invoked on surface commit</div></li><li><div class="item-name"><a class="fn" href="fn.get_children.html" title="fn smithay::wayland::compositor::get_children">get_children</a></div><div class="desc docblock-short">Retrieve the children of this surface</div></li><li><div class="item-name"><a class="fn" href="fn.get_parent.html" title="fn smithay::wayland::compositor::get_parent">get_parent</a></div><div class="desc docblock-short">Retrieve the parent of this surface</div></li><li><div class="item-name"><a class="fn" href="fn.get_region_attributes.html" title="fn smithay::wayland::compositor::get_region_attributes">get_region_attributes</a></div><div class="desc docblock-short">Retrieve the metadata associated with a <code>wl_region</code></div></li><li><div class="item-name"><a class="fn" href="fn.get_role.html" title="fn smithay::wayland::compositor::get_role">get_role</a></div><div class="desc docblock-short">Get the current role of this surface</div></li><li><div class="item-name"><a class="fn" href="fn.give_role.html" title="fn smithay::wayland::compositor::give_role">give_role</a></div><div class="desc docblock-short">Register that this surface has given role</div></li><li><div class="item-name"><a class="fn" href="fn.is_sync_subsurface.html" title="fn smithay::wayland::compositor::is_sync_subsurface">is_sync_subsurface</a></div><div class="desc docblock-short">Check if this subsurface is a synchronized subsurface</div></li><li><div class="item-name"><a class="fn" href="fn.with_states.html" title="fn smithay::wayland::compositor::with_states">with_states</a></div><div class="desc docblock-short">Access the states associated to this surface</div></li><li><div class="item-name"><a class="fn" href="fn.with_surface_tree_downward.html" title="fn smithay::wayland::compositor::with_surface_tree_downward">with_surface_tree_downward</a></div><div class="desc docblock-short">Access the data of a surface tree from top to bottom</div></li><li><div class="item-name"><a class="fn" href="fn.with_surface_tree_upward.html" title="fn smithay::wayland::compositor::with_surface_tree_upward">with_surface_tree_upward</a></div><div class="desc docblock-short">Access the data of a surface tree from bottom to top</div></li></ul></section></div></main></body></html>